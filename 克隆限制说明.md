# 克隆网站的限制说明

## 为什么克隆后仍然有外部请求？

### 问题现象
访问克隆的网站时，浏览器开发者工具（F12 → Network）中仍然显示很多请求到原始网站或其他域名。

### 根本原因

#### 1. JavaScript 中硬编码的 URL
现代 Web 应用的 JavaScript 代码中包含大量硬编码的 URL：

```javascript
// 示例：JavaScript 代码中的硬编码 URL
const API_BASE = 'https://app.apifox.com/api';
fetch(`${API_BASE}/user/info`);  // 这个请求会直接发送到原始服务器

// 或者
axios.get('https://app.apifox.com/api/projects');
```

**我们无法修改这些 URL**，因为：
- JavaScript 文件已经被压缩和混淆
- URL 可能是动态生成的
- 修改可能破坏代码逻辑

#### 2. 浏览器直接发起的请求
克隆的工作流程：
```
用户浏览器 → 本地服务器(127.0.0.1:7754) → 返回 HTML/CSS/JS
     ↓
JavaScript 执行
     ↓
直接向原始服务器发起请求（绕过本地服务器）
```

**本地服务器无法拦截**浏览器直接向其他域名发起的请求。

#### 3. 第三方资源
网站通常会加载：
- CDN 资源（字体、图标库等）
- 分析服务（Google Analytics、百度统计等）
- 广告服务
- 社交媒体插件

这些都是直接从第三方域名加载的。

## 我们的克隆做了什么？

### 当前实现
1. **保存静态资源**：使用 Playwright 拦截并保存所有通过浏览器加载的资源
2. **替换 HTML 中的 URL**：将 HTML 中的资源 URL 替换为本地路径
3. **提供本地服务**：启动 HTTP 服务器提供这些本地文件

### 能做到的
- ✅ HTML 文件从本地加载
- ✅ CSS 文件从本地加载
- ✅ JavaScript 文件从本地加载
- ✅ 图片、字体等静态资源从本地加载

### 做不到的
- ❌ 修改 JavaScript 代码中的硬编码 URL
- ❌ 拦截浏览器直接向其他域名的请求
- ❌ 阻止第三方服务的加载
- ❌ 让动态功能（API 调用）正常工作

## 查看日志

### 本地服务器日志
在控制台中可以看到本地服务器处理的请求：
```
[Project xxx] 127.0.0.1 - - [11/Feb/2026 17:00:00] "GET /index.html HTTP/1.1" 200 -
[Project xxx] 127.0.0.1 - - [11/Feb/2026 17:00:00] "GET /assets/style.css HTTP/1.1" 200 -
[Project xxx] 127.0.0.1 - - [11/Feb/2026 17:00:00] "GET /api/user HTTP/1.1" 404 -
```

### 浏览器网络日志
在浏览器开发者工具（F12 → Network）中：
- **127.0.0.1:7754** 的请求 → 本地服务器处理
- **其他域名** 的请求 → 浏览器直接发送，本地服务器无法控制

## 解决方案对比

### 方案 1：纯静态克隆（当前方案）
**特点**：
- 只保存和提供静态文件
- API 请求返回 404
- 不转发任何请求到原始服务器

**优点**：
- 完全离线（静态资源部分）
- 不依赖原始服务器
- 隐私保护（不发送数据到原始服务器）

**缺点**：
- 所有动态功能不可用
- JavaScript 仍会尝试请求原始 API（但会失败）
- 页面可能显示错误

**适用场景**：
- 保存网站快照
- 查看网站外观
- 学习前端代码

### 方案 2：反向代理（之前的方案）
**特点**：
- 静态文件从本地加载
- API 请求转发到原始服务器

**优点**：
- 静态资源加载快
- 所有功能正常工作
- 用户体验完整

**缺点**：
- 需要网络连接
- 仍然依赖原始服务器
- 会发送数据到原始服务器

**适用场景**：
- 加速访问
- 本地开发测试
- 需要使用完整功能

### 方案 3：完全阻止外部请求
**实现方式**：
- 使用浏览器扩展（如 uBlock Origin）
- 配置浏览器代理
- 修改 hosts 文件

**特点**：
- 在浏览器层面阻止所有外部请求

**优点**：
- 真正的完全离线
- 不会有任何外部请求

**缺点**：
- 需要额外配置
- 页面可能完全无法使用
- 不是我们系统的一部分

## 如何验证克隆效果？

### 1. 检查本地服务器日志
查看控制台输出，确认哪些请求被本地服务器处理。

### 2. 检查浏览器网络面板
打开 F12 → Network：
- 筛选 `127.0.0.1:7754` 的请求 → 这些是从本地加载的
- 其他域名的请求 → 这些是 JavaScript 直接发起的

### 3. 断网测试
断开网络连接后访问克隆的网站：
- 能加载的部分 → 已成功克隆到本地
- 无法加载的部分 → 依赖外部资源

## 总结

**现实情况**：
- 完全静态化克隆一个现代 Web 应用（特别是 SPA）是**非常困难的**
- JavaScript 中的硬编码 URL 无法自动替换
- 浏览器直接发起的请求无法被本地服务器拦截

**我们的系统做到了**：
- ✅ 保存所有静态资源到本地
- ✅ 提供快速的本地访问
- ✅ 减少对原始服务器的静态资源请求

**我们的系统做不到**：
- ❌ 阻止 JavaScript 向原始服务器发起请求
- ❌ 让依赖后端 API 的功能正常工作
- ❌ 完全离线使用动态 Web 应用

**建议**：
- 如果需要完整功能 → 使用反向代理方案
- 如果只需要查看外观 → 使用当前纯静态方案
- 如果需要完全离线 → 只克隆静态网站（如文档、博客等）
